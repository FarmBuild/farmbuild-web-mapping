<!doctype>
<html lang="en">
<head>
    <link rel="stylesheet" href="../css/ol.css" type="text/css">
    <style>
        .map {
            height: 100%;
            width: 100%;
        }
    </style>
    <script src="../lib/ol.js" type="text/javascript"></script>
    <script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>
    <script type="text/javascript" src="../bower_components/proj4/dist/proj4.js"></script>
    <title>OpenLayers 3 example</title>
</head>
<body>
<h2>My Map</h2>

<div id="map" class="map">
</div>

<div id="gmap" class="map">
</div>

<script type="text/javascript">

    proj4.defs("EPSG:3111", "+proj=lcc +lat_1=-36 +lat_2=-38 +lat_0=-37 +lon_0=145 +x_0=2500000 +y_0=2500000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");

    var projection = ol.proj.get('EPSG:3111');

    var gmap = new google.maps.Map(document.getElementById('gmap'), {
        disableDefaultUI: true,
        keyboardShortcuts: false,
        draggable: false,
        disableDoubleClickZoom: true,
        scrollwheel: false,
        streetViewControl: false
    });

    var view = new ol.View({
        center: ol.proj.transform([145.57368096419663, -36.224879531701255], 'EPSG:4326', 'EPSG:3857'),
        zoom: 15,
        rotation:0
    });

    view.on('change:center', function() {
        var center = ol.proj.transform(view.getCenter(), 'EPSG:3857', 'EPSG:4326');
        gmap.setCenter(new google.maps.LatLng(center[1], center[0]));
    });
    view.on('change:resolution', function() {
        gmap.setZoom(view.getZoom());
    });

    selector = 'map';

    data = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [
                                145.57368096419663,
                                -36.224879531701255
                            ],
                            [
                                145.5826132801325,
                                -36.22488327137526
                            ],
                            [
                                145.58260951039628,
                                -36.22801228957186
                            ],
                            [
                                145.57363088613704,
                                -36.22803939355771
                            ],
                            [
                                145.57368096419663,
                                -36.224879531701255
                            ]
                        ]
                    ]
                },
                "properties": {
                    "tag": "bc:22:0b:a6:3f:29",
                    "id": "30",
                    "title": "Marc Compte",
                    "objectType": "people",
                    "parent": "1"
                }
            }
        ]
    };

    var vS=new ol.source.GeoJSON(
            ({
                "object": data,
                projection: 'EPSG:3857'
            })
    );
    var vL= new ol.layer.Vector({source: vS});
    var map = new ol.Map({
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            }),
            vL
        ],
        target: selector,
        view: view
    });

    var olMapDiv = document.getElementById('map');
    gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(olMapDiv);
    olMapDiv.parentNode.removeChild(document.getElementById('gmap'));

//    var extent = vL.getExtent();
//    map.getView().fitExtent(extent,map.getSize());

</script>
</body>
</html>